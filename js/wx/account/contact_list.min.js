function add_contact(){location.href=apppath+"/wx/contact/add.action?"+ddcommparams+"&from=con_list"}function con_list_back(){"block"==$("#filter_area").css("display")?($("#filter_area").hide(),$(".filter").removeClass("active"),$(".filter").addClass("normal")):location.href=apppath+"/wx/statics/index.action?"+ddcommparams}function filter(){stopScroll($("#filter_area"));var t=0;$("#filter").on("click",function(){$("#filter_area .content").find(".filter_btn").length<=1&&create_filter(),0==t?($("#filter").addClass("active"),$("#filter").removeClass("normal"),t=1):($("#filter").addClass("normal"),$("#filter").removeClass("active"),t=0),$("#filter_area").toggle()})}function create_filter(){$.ajax({type:"get",url:apppath+"/wx/contact/getCreateDateTypeInfo.action",async:!0,dataType:"json",success:function(t){if(0==t.success)myAlert("暂时无法获取数据，请稍后再试");else{for(var e=[],a=0,o=t.entity.length;o>a;a++){var i=$('<div class="filter_btn boxSizing">'+t.entity[a].label+"</div>");e.push(t.entity[a].value),$("#filter_area .content").append(i)}$("#filter_area .filter_btn").eq(0).addClass("active"),$("#filter_area .filter_btn").each(function(t){$(this).on("click",function(){pageNo=0,$(this).addClass("active"),$(this).siblings().removeClass("active"),$("#filter_area").hide(),$("#list").children().remove();var t=e[$(this).index()];$(this).index()>0?(arr=[],create_contact_list(t)):(arr=[],create_contact_list())})})}},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function create_contact_list(t){$.ajax({type:"get",url:apppath+"/wx/contact/dolist.action",data:{pageNo:pageNo,pagesize:pageSize,createDateType:t},async:!0,dataType:"json",success:function(t){if($(".load-shadow").hide(),0==t.success)t.entity&&t.entity.status&&"0000003"==t.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("暂时无法获取数据，请稍后再试");else{for(var e=0,a=t.entity.records.length;a>e;e++)arr.push(t.entity.records[e]);if(0==t.entity.records.length){var o=$('<div class="content-reminder"><div class="ico"><p>暂无数据</p></div></div>');$("#list").append(o)}else build_list(arr);$("#list").find(".con").length<t.entity.totalSize?($("#loading").remove(),build_end("加载更多","load_more"),pageNo+=1,loaded()):$("#loading").remove()}},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_list(t){for(var e,a=pageNo*pageSize;a<t.length;a++){e=/(?!^(\d+|[~!@#$%^&*?]+)$)^[\w~!@#$%\^&*?]+$/.test(t[a].contactName_py.substr(0,1))?t[a].contactName_py.substr(0,1):"#";var o,i=icon_word(t,a),n=$("#list").find('div[id="'+e.toUpperCase()+'"]');if(n.size())o=n.parent();else{if(0==a){var c=$("<li></li>"),r=$('<div class="top boxSizing" id="'+e.toUpperCase()+'">'+e.toUpperCase()+"</div>");c.append(r)}else if(e!=t[a-1].contactName_py.substr(0,1)&&!/^\d$/.test(t[a].contactName_py.substr(0,1))){var c=$("<li></li>"),r=$('<div class="top boxSizing" id="'+e.toUpperCase()+'">'+e.toUpperCase()+"</div>");c.append(r)}$("#list").append(c),o=$("#list > li:last")}var s=t[a].id,l=document.createElement("div");$(l).attr("value",s),l.className="con boxSizing";var d=t[a].contactName,p=t[a].post,f=t[a].accountName,u=t[a].mobile;console.log(d),$(l).append($('<div class="pic boxSizing"><i class="cir">'+i+'</i></div><div class="info boxSizing"> <span class="name">'+d+'</span> <span class="job">'+p+'</span><span class="company boxSizing">'+f+'</span><a class="tel" href="tel:'+u+'"></a></div>')),$("#list > li:last").append(l),$(l).find(".tel").on("click",function(t){var e=$(this).parent().parent().attr("value");location.href=apppath+"/wx/activityrecord/create.action?"+ddcommparams+"&belongId=2&objectId="+e+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=con_info&contactId="+e,t.stopPropagation()}),o.append(l),set_cir_color($(l).find(".cir"))}con_click()}function icon_word(t,e){return/^[\u4e00-\u9fa5]+$/.test(t[e].contactName.substr(0,1))?t[e].contactName.substr(-2):t[e].contactName.substr(0,2)}function con_click(){$("#list .con").each(function(t){$(this).click(function(){var t=$(this).attr("value"),e=$(this).find("span.name").text();location.href=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+t,local_set(t,e,2)})})}function local_set(t,e,a){if(1==a||2==a){var o={id:t,name:e,kindle:a};if(localStorage.getItem(userId)){var i=JSON.parse(localStorage.getItem(userId));if(i.accountHistory){for(var n=0;n<i.accountHistory.length;n++)i.accountHistory[n].id==t&&i.accountHistory.remove(n);i.accountHistory.push(o)}else var i={accountHistory:[o]}}else var i={accountHistory:[o]}}else if(3==a){var o={id:t,name:e};if("undefined"!=localStorage.getItem(userId)){var i=JSON.parse(localStorage.getItem(userId));if(i.opportunityHistory){for(var n=0;n<i.opportunityHistory.length;n++)i.opportunityHistory[n].id==t&&i.opportunityHistory.remove(n);i.opportunityHistory.push(o)}else var i={opportunityHistory:[o]}}else var i={opportunityHistory:[o]}}localStorage.setItem(userId,JSON.stringify(i))}function build_end(t,e){var a=$('<div id="'+e+'" class="end_info">'+t+"</div>");$("#list").append(a)}function loaded(){myScroll=new IScroll("#content",{probeType:1,mouseWheel:!0,preventDefault:!1,scrollbars:!0,momentum:!0,useTransform:!1,click:!0,tap:!0,bounceTime:200,mouseWheelSpeed:200}),myScroll.on("scrollStart",function(){$("#load_more").length>0&&($("#load_more").remove(),build_end("加载中…","loading"),create_contact_list())}),myScroll.on("scrollEnd",function(){$("#loading").remove()})}$(document).on("ready",function(){$("#txt").on("click",function(){location.href=apppath+"/wx/account/search.action?"+ddcommparams}),create_contact_list(),filter(),$("#company").on("click",function(){location.href=apppath+"/wx/account/list.action?"+ddcommparams}),$("#ipt_area").on("click",function(){location.href=apppath+"/wx/account/search.action?"+ddcommparams}),$("#addContact").on("click",function(){add_contact()})}),$(document).ready(function(){});var pageNo=0,pageSize=20,arr=[],userId=xsyUser.id,myScroll;