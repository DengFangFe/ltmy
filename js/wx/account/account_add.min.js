function getAddAcctountDesc(){$.ajax({url:apppath+"/wx/account/getDetail.action",dataType:"json",data:{scene:"ADD"},type:"GET",beforeSend:function(){},success:function(t){if(0==t.success&&(myAlert("加载数据失败，请稍后再试"),$(".load-shadow").hide()),1==t.success){$(".load-shadow").hide();var e=JSON.stringify(t);console.log(e);var n=t.entity.structure.components;$.each(n,function(t,e){customizItem($("#basic_info"),e,selectitmeObj)}),$("body").append('<button id="confirm" class="confirm">保存</button>'),$("body").append('<button id="add_contact" class="confirm">保存并添加联系人</button>'),confirm(),SelectItemPost(),textarea_num(),DummyItemPost(),checkboxItemPost(),dimdepart_choose(),levelChoose(),statusChoose(),industryChoose(),parentAccountChoose(),ownerChoose(),$("textarea").autoHeight(),region(),"set"==GetQueryString("type")?(set_info(),$("#add_contact").remove(),$("#confirm").html("保存")):setPost=!0}},complete:function(){},error:function(t){alert(t)}})}function region(){$("#region1").cityPicker({title:"省市区"})}function createSecondaryList(t,e){for(var n=$('<div class="container"></div>'),a=0,i=t.entity.length;i>a;a++){var o=$('<div class="item boxSizing"><em class="radio"><i></i></em><span>'+t.entity[a].label+"</span></div>");n.append(o)}$(".ct").append(n);for(var a=0,i=$(".ct .item").length;i>a;a++)$("#el button").html()==$(".ct .item").eq(a).find("span").text()&&(console.log($("#el button").html()),$(".ct .item").eq(a).find("em").addClass("active"));$(".ct .item").each(function(n){$(this).on("click",function(){$(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active");var n=t.entity[$(this).index()].value,a=($(this).index(),t.entity[$(this).index()].label);$(e).find("button").html(a),$(e).find("button").attr("value",n),btn_color_adjust(),$(".ct").remove(),$("body").css({overflow:"scroll",height:"auto"})})})}function levelChoose(){$("#level").on("click",function(){checkTable("选择公司等级"),$.ajax({type:"get",url:apppath+"/wx/account/getLevelInfo.action",async:!0,dataType:"json",success:function(t){if(t.success){console.log("公司等级"+t);var e=document.getElementById("level");createSecondaryList(t,e)}else myAlert("暂时无法获取数据，请稍后再试")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})})}function statusChoose(){$("#dbcSelect1").attr("value",1),$("#dbcSelect1").on("click",function(){checkTable("选择公司状态"),$.ajax({type:"get",url:apppath+"/wx/account/getstates.action",async:!0,dataType:"json",success:function(t){if(t.success){console.log("公司状态"+t);var e=document.getElementById("dbcSelect1");createSecondaryList(t,e)}else myAlert("暂时无法获取数据，请稍后再试")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})})}function industryChoose(){$("#industryId").on("click",function(){checkTable("选择行业"),$.ajax({type:"get",url:apppath+"/wx/account/industryIds.action",async:!0,dataType:"json",success:function(t){if(t.success){console.log("选择行业"+t);var e=document.getElementById("industryId");createSecondaryList(t,e)}else myAlert("暂时无法获取数据，请稍后再试")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})})}function parentAccountChoose(){$("#parentAccountId").on("click",function(){checkTable("选择上级客户"),$.ajax({type:"get",url:apppath+"/wx/account/dolist.action",async:!0,dataType:"json",success:function(t){console.log("上级客户"+t),0==t.success?myAlert("暂时无法获取数据，请稍后再试"):(accountData=t,create_parentAccount_list(t),$("#parentAccountId").attr("value",accountData.entity.records[0].id),$("#parentAccountId  button").html(accountData.entity.records[0].accountName))},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})})}function create_parentAccount_list(t){for(var e=$('<div class="container"></div>'),n=0,a=t.entity.records.length;a>n;n++){var i=$('<div class="item boxSizing"><em class="radio"><i></i></em><span>'+t.entity.records[n].accountName+"</span></div>");i.attr("value",t.entity.records[n].id),e.append(i)}$(".ct").append(e);for(var n=0,a=$(".ct .item").length;a>n;n++)$("#parentAccountId button").html()==$(".ct .item").eq(n).find("span").text()&&$(".ct .item").eq(n).find("em").addClass("active");$(".ct .item").each(function(e){$(this).on("click",function(){$(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active");var e=t.entity.records[$(this).index()].id,n=($(this).index(),t.entity.records[$(this).index()].accountName);$("#parentAccountId button").html(n),btn_color_adjust(),$("#parentAccountId button").attr("value",e),$(".ct").remove(),$("body").css({overflow:"scroll",height:"auto"})})})}function ownerChoose(){$("#ownerId").on("click",function(){checkTable("选择客户所有人"),$.ajax({type:"get",url:apppath+"/wx/xsyuser/pager.action",async:!0,dataType:"json",success:function(t){console.log("客户所有人"+t),0==t.success?myAlert("暂时无法获取数据，请稍后再试"):(ownerData=t,create_owner_list(t),ownerPost&&($("#parentAccountId").attr("value",accountData.entity.records[0].id),$("#parentAccountId  button").html(accountData.entity.records[0].name)))},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})})}function create_owner_list(t){for(var e=$('<div class="container"></div>'),n=0,a=t.entity.records.length;a>n;n++){var i=$('<div class="item boxSizing"><em class="radio"><i></i></em><span>'+t.entity.records[n].name+"</span></div>");i.attr("value",t.entity.records[n].id),e.append(i)}$(".ct").append(e);for(var n=0,a=$(".ct .item").length;a>n;n++)$("#ownerId button").html()==$(".ct .item").eq(n).find("span").text()&&$(".ct .item").eq(n).find("em").addClass("active");$(".ct .item").each(function(e){$(this).on("click",function(){$(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active");var e=t.entity.records[$(this).index()].id,n=($(this).index(),t.entity.records[$(this).index()].name);$("#ownerId button").html(n),btn_color_adjust(),$("#ownerId button").attr("value",e),$(".ct").remove(),$("body").css({overflow:"scroll",height:"auto"})})})}function confirm(){function t(t){regingData()&&info_submit(t)}$("#confirm").on("click",function(){t()}),$("#add_contact").on("click",function(){t("add_contact")})}function info_submit(t){var e="";if("set"==GetQueryString("type")){e=apppath+"/wx/account/doupdate.action",console.log("更新接口");var n={id:GetQueryString("accountId")};$("#basic_info .item").each(function(){var t,e=$(this);if(e.find("input").size()){if("region"==e.attr("id")){var a=e.find("input").val(),i=a.split(" ");return n.state=i[0],n.city=i[1],void(n.region=i[2])}var o=e.attr("btype");if("ITEM_TYPE_INTEGER"==o&&""==e.find("input").val()||"ITEM_TYPE_REAL"==o&&""==e.find("input").val())return;t=e.find("input").val()}if(e.find("button").size()){var c=e.find("button");if(""==c.html()||"点击选择"==c.html())t=null;else if("ITEM_TYPE_CHECKBOX"==e.attr("btype")){var s=[];s=e.find("button").attr("value").split(","),t=(s.length=0)?[]:s,console.log(s)}else t=e.find("button").attr("value")}e.find("textarea").size()&&(t=e.find("textarea").val()),n[e.attr("id")]=t})}else{e=apppath+"/wx/account/docreate.action",console.log("创建接口");var n={};$("#basic_info .item").each(function(){var t,e=$(this);if(e.find("input").size()){if("region"==e.attr("id")){var a=e.find("input").val(),i=a.split(" ");return n.state=i[0],n.city=i[1],void(n.region=i[2])}t=e.find("input").val()}if(e.find("button").size()){var o=e.find("button");if(""==o.html()||"点击选择"==o.html())t=null;else if("ITEM_TYPE_CHECKBOX"==e.attr("btype")){var c=[];c=e.find("button").attr("value").split(","),t=(c.length=0)?[]:c,console.log(c)}else t=e.find("button").attr("value")}e.find("textarea").size()&&(t=e.find("textarea").val()),n[e.attr("id")]=t})}$.ajax({type:"post",url:e,data:{account:JSON.stringify(n)},dataType:"json",async:!0,beforeSend:function(){$(".confirm").attr("disabled","true"),loader()},success:function(e){$(".loaderArea").remove(),1==e.success?(myDialog("保存成功"),setTimeout(function(){if("add_contact"==t)location.replace(apppath+"/wx/contact/add.action?"+ddcommparams+"&from=acc_add&accountId="+n+"&accountName="+e.entity.data.accountName);else{if("set"==GetQueryString("type"))var n=GetQueryString("accountId");else var n=e.entity.id;location.replace(apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+n)}},2e3)):0==e.success&&($(".confirm").removeAttr("disabled"),e.entity&&e.entity.status&&"0000001"==e.entity.status?myAlert("保存失败，公司名称已存在"):e.entity&&e.entity.status&&"0000002"==e.entity.status?myAlert("保存失败，不能包含表情符"):e.entity&&e.entity.status&&"0000003"==e.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("保存失败，请检查输入信息"))},error:function(){$(".loaderArea").remove(),$(".confirm").removeAttr("disabled"),myAlert("暂时无法获取数据，请检查您的网络")}})}function set_info(){$.ajax({url:apppath+"/wx/account/getDetail.action",data:{accountId:GetQueryString("accountId"),scene:"UPDATE"},dataType:"json",success:function(t){$("#basic_info .item").each(function(){var e,n,a=$(this),i=set_infoSup(a.attr("id"),t);if("object"==typeof i?(e=i.text,n=i.value):e=n=i,a.find("input").size()){if("region"==a.attr("id")){var o=t.entity.data.state,c=t.entity.data.city,s=t.entity.data.region,r=o+" "+c+" "+s;return void a.find("input").val(r)}a.find("input").val(n)}a.find("button").size()&&(a.find("button").attr("value",n),a.find("button").html(e)),a.find("textarea").size()&&a.find("textarea").val(n)}),btn_color_adjust(),$("textarea").autoHeight(),textarea_num()}})}$(document).on("ready",function(){getAddAcctountDesc(),$("textarea").autoHeight(),xsyUser||alert("获取当前用户失败"),"set"==GetQueryString("type")&&(document.title="修改客户"),btn_color_adjust(),btn_touch_style(),input_color_adjust(),$("input").each(function(){$(this).on("click",function(){$(this).hasClass("warn")&&remove_warn($(this))})}),input_adjust()});var reg_accountName=/^.{1,50}$/,reg_tel=/^\d+|[-#*]{0,30}$/,reg_address=/^.{0,250}$/,reg_fax=/^.{0,30}$/,selectitmeObj={},postData,setPost=!1,accountData,accountPost=!1,ownerData,ownerPost=!1,ownerId=xsyUser.id;