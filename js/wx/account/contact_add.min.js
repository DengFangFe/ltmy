function getAddContactDesc(){$.ajax({url:apppath+"/wx/contact/getDetail.action",dataType:"json",data:{scene:"ADD"},type:"GET",beforeSend:function(){},success:function(t){if(0==t.success&&(myAlert("加载数据失败，请稍后再试"),$(".load-shadow").hide()),1==t.success){$(".load-shadow").hide(),dataString=JSON.stringify(t),console.log(dataString);var a=t.entity.structure.components;$.each(a,function(t,a){customizItem($("#basic_info"),a,selectitmeObj)}),$("#ownerId").find("button").html(userName),$("#ownerId").find("button").attr("value",ownerId),$("#ownerId").find("button").attr("readonly",!0),$("body").append('<button id="confirm" class="confirm">保存</button>'),$("body").append('<button id="add_contact" class="confirm">保存并添加新联系人</button>'),confirm(),selectDate(),dimdepart_choose(),textarea_num(),SelectItemPost(),DummyItemPost(),$("textarea").autoHeight(),"acc_add"==GetQueryString("from")?($("#accountId button").html(GetQueryString("accountName")),$("#accountId button").attr("value",GetQueryString("accountId")),$("#accountId button").attr("disabled","disabled"),$("#accountId button").css("color","#ccc"),$("#add_contact").html("保存并添加更多"),btn_color_adjust(),set_back(apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("accountId"))):"acc_info"==GetQueryString("from")?($("#accountId button").html(GetQueryString("accountName")),$("#accountId button").attr("value",GetQueryString("accountId")),$("#accountId button").attr("disabled","disabled"),$("#add_contact").html("确定并添加联系人"),set_back(apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("accountId"))):accountPost(),"con_list"==GetQueryString("from")&&$("#add_contact").remove(),"con_info"==GetQueryString("from")&&location.replace(apppath+"wx/contact/info.action?"+ddcommparams+"&contactId="+GetQueryString("contactId")),"set"==GetQueryString("type")?(set_info(),$("#add_contact").remove(),$("#confirm").html("保存")):setPost=!0,"from_acc_info"==GetQueryString("type")&&($("#add_contact").remove(),$("#confirm").html("保存"))}},complete:function(){},error:function(t){alert(t)}})}function contactNameReg(){$("#contactName input").on("blur",function(){for(var t=$("#contactName input").val();t.lastIndexOf(" ")>=0;)t=t.replace(" ","");$("#contactName input").val(t)})}function confirm(){function t(t){regingData()&&info_submit(t)}$("#confirm").on("click",function(){t()}),$("#add_contact").on("click",function(){t("add_contact")})}function get_post(){$.ajax({type:"get",url:apppath+"/wx/department/mydepartment.action",async:!0,dataType:"json",success:function(t){console.log("部门"+t),0==t.success?myAlert("暂时无法获取数据，请稍后再试"):(postData=t,setPost&&($("#dimDepart button").attr("value",postData.entity.departs[0].id),$("#dimDepart button").html(postData.entity.departs[0].text)))},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function info_submit(t){var a="";if("set"==GetQueryString("type")){a=apppath+"/wx/contact/doupdate.action",console.log("更新接口");var n={id:GetQueryString("contactId")};$("#basic_info .item").each(function(){var t,a=$(this);if(a.find("input").size()){var e=a.attr("btype");if("ITEM_TYPE_INTEGER"==e&&""==a.find("input").val()||"ITEM_TYPE_REAL"==e&&""==a.find("input").val())return;t=a.find("input").val()}if(a.find("button").size()){var o=a.find("button");if(""==o.html()||"点击选择"==o.html())t=null;else if("ITEM_TYPE_CHECKBOX"==a.attr("btype")){var c=[];c=a.find("button").attr("value").split(","),t=(c.length=0)?[]:c,console.log(c)}else t=a.find("button").attr("value")}a.find("textarea").size()&&(t=a.find("textarea").val()),n[a.attr("id")]=t})}else{a=apppath+"/wx/contact/docreate.action",console.log("创建接口");var n={};$("#basic_info .item").each(function(){var t,a=$(this);if(a.find("input").size()){var e=a.attr("btype");if("ITEM_TYPE_INTEGER"==e&&""==a.find("input").val()||"ITEM_TYPE_REAL"==e&&""==a.find("input").val())return;t=a.find("input").val()}else if(a.find("button").size()){var o=a.find("button");if(""!=o.html()&&"点击选择"!=o.html()||(t=null),"ITEM_TYPE_CHECKBOX"==a.attr("btype")){var c=[];c=a.find("button").attr("value").split(","),t=(c.length=0)?[]:c,console.log(c)}else t=a.find("button").attr("value")}a.find("textarea").size()&&(t=a.find("textarea").val()),n[a.attr("id")]=t})}console.log(n),$.ajax({type:"post",url:a,data:{contact:JSON.stringify(n)},async:!0,beforeSend:function(){$(".confirm").attr("disabled",!0),loader()},dataType:"json",success:function(a){$(".loaderArea").remove(),1==a.success?(myDialog("保存成功"),setTimeout(function(){"add_contact"==t?location.href=apppath+"/wx/contact/add.action?"+ddcommparams+"&from=acc_add&accountId="+$("#accountName").attr("value")+"&accountName="+$("#accountName button").html():"acc_add"==GetQueryString("from")?location.replace(apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+$("#accountName").attr("value")):"con_list"==GetQueryString("from")?location.replace(apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+a.entity.id):"con_info"==GetQueryString("from")?location.replace(apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+GetQueryString("contactId")):"acc_info"==GetQueryString("from")&&location.replace(apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+a.entity.id+"&from=acc_info&accountId="+GetQueryString("accountId"))},2e3)):0==a.success&&($(".confirm").removeAttr("disabled"),a.entity&&a.entity.key&&"mobile"==a.entity.key?myAlert("保存失败，手机号码重复"):a.entity&&a.entity.status&&"0000002"==a.entity.status?myAlert("保存失败，不能包含表情符"):a.entity&&a.entity.status&&"0000003"==a.entity.status?location.replace(apppath+"/wx/authorized/no.action?"+ddcommparams):myAlert("保存失败，请检查输入信息"))},error:function(){$(".loaderArea").remove(),$(".confirm").removeAttr("disabled"),myAlert("暂时无法获取数据，请检查您的网络")}})}function set_info(){$.ajax({type:"get",url:apppath+"/wx/contact/getDetail.action",data:{contactId:GetQueryString("contactId"),scene:"UPDATE"},async:!0,dataType:"json",success:function(t){console.log(t),$("#basic_info .item").each(function(){var a,n,e=$(this),o=set_infoSup(e.attr("id"),t);"object"==typeof o?(a=o.text,n=o.value):a=n=o,e.find("input").size()&&e.find("input").val(n),e.find("button").size()&&(e.find("button").attr("value",n),e.find("button").html(a)),e.find("textarea").size()&&e.find("textarea").val(n)}),btn_color_adjust(),$("textarea").autoHeight(),textarea_num()}})}$(document).on("ready",function(){getAddContactDesc(),get_post(),input_color_adjust(),xsyUser||alert("获取当前用户失败"),btn_touch_style(),"set"==GetQueryString("type")&&(document.title="修改联系人"),contactNameReg()});var dataString,selectitmeObj={},userName=xsyUser.name,reg_contactName=/^.{1,50}$/,reg_phone=/^\d+|[-#*]{1,30}$/,reg_department=/^.{0,20}$/,reg_post=/^.{0,50}$/,reg_tel=/^\d+|[-#*]{0,30}$/,reg_email=/^(([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})){0,100}$/,reg_address=/^.{0,250}$/,postData,setPost=!1,ownerId=xsyUser.id;