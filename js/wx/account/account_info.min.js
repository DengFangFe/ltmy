function linkMore(){$(".link_more").on("click",function(){$(".options").toggle()})}function toAccountList(){$(".cOwnerShadow").remove(),$(".ct").length>0?memberChange?myChoose("",ctRemove):ctRemove():"opp_info"==GetQueryString("from")?location.href=apppath+"/wx/opportunity/detail.action?"+ddcommparams+"&opportunityId="+GetQueryString("ropportunityId"):"con_info"==GetQueryString("from")?location.href=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+GetQueryString("rcontactId"):"acc_info"==GetQueryString("from")?location.href=apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("raccountId"):"index"==GetQueryString("from")?GetQueryString("page")?location.href=apppath+"/wx/statics/index.action?"+ddcommparams+"&page="+GetQueryString("page"):location.href=apppath+"/wx/statics/index.action?"+ddcommparams:location.href=apppath+"/wx/account/list.action?"+ddcommparams}function ctRemove(){$("body").css("height",""),$("body").css("overflow",""),ceilingJudge(),$(".ct").remove()}function more(){$("#area").length>0?$("#area").remove():($("#add_contact").on("click",function(){$("window").off("beforeunload"),$("#area").remove(),location.href=apppath+"/wx/contact/add.action?"+ddcommparams+"&from=acc_info&accountId="+GetQueryString("accountId")+"&accountName="+accountName}),$("#new_business").on("click",function(){$("#area").remove(),console.log("跳转到新建销售机会页面"),location.href=apppath+"/wx/opportunity/add.action?"+ddcommparams+"&from=acc_info&accountId="+GetQueryString("accountId")}),$("#set_account").on("click",function(){$("#area").remove(),location.href=apppath+"/wx/account/add.action?"+ddcommparams+"&type=set&from=acc_info&accountId="+GetQueryString("accountId")}),$("#delete_account").on("click",function(){$("#area").remove(),delete_dialog()}))}function delete_dialog(){var t=$('<div class="delShadow"><div class="dia"><p class="boxSizing">确定删除吗?</p><div class="confirm"><div class="no">取消</div><div class="yes boxSizing">确认</div></div></div></div>');$("body").append(t),$(".dia").css({top:"200px",left:($(window).width()-$(".dia").width())/2}),$(".yes").on("click",function(){delete_account(),$(".delShadow").remove()}),$(".no").on("click",function(){$(".delShadow").remove()})}function delete_account(){$.ajax({url:apppath+"/wx/account/dodel.action",data:{accountId:GetQueryString("accountId")},async:!1,dataType:"json",success:function(t){t.success?($(".shadow").remove(),myDialog("删除成功"),time_out_location(apppath+"/wx/account/list.action?"+ddcommparams)):myAlert("删除失败")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function top_nav(){$(window).on("scroll",function(){ceilingJudge()})}function ceilingJudge(){$("body").scrollTop()>=nav_top+120?($(".top_meun").css({position:"fixed",top:0}),$(".common").css("paddingBottom","90px")):($(".top_meun").css({position:"static",top:"",bottom:""}),$(".common").css({paddingBottom:"",position:"relative"}))}function nav(){$("#topNav").on("scroll",function(){$("#nav").offset().left>-20?$(".left_filter").fadeOut(200):$(".left_filter").fadeIn(200),$("#nav").offset().left<=$(window).width()-$("#nav").width()-30?$(".right_filter").fadeOut(200):$(".right_filter").fadeIn(200)}),$("#nav li").each(function(){$(this).on("click",function(){$(this).addClass("active"),$(this).siblings().removeClass("active"),tab($(this).attr("href"))})})}function filter_touch(){$(".right_filter").on("touchend",function(){$("#topNav").scrollLeft(300)}),$(".left_filter").on("touchend",function(){$("#topNav").scrollLeft(0)})}function tab(t){if($("html, body").animate({scrollTop:0},300),$("#topNav").css({position:"",top:"",bottom:""}),$(".common").css({paddingBottom:"",position:"relative"}),$(".content").fadeOut(300),"联系人"==t){if(0==$("#contact_tab").length){$(".tab").length>0&&$(".tab").remove();var e=$('<ul id="contact_tab" class="tab contact boxSizing"><div class="main boxSizing"></div></ul>');$("body").append(e),contactPageNo=0,get_contacts($("#contact_tab > .main"),20,"tab"),$("#contact_tab").fadeIn(300)}}else if("记录"==t){if(0==$("#record_tab").length){$(".tab").length>0&&$(".tab").remove();var e=$('<ul id="record_tab" class="tab record boxSizing"><div class="main boxSizing"></div></ul>');$("body").append(e),recordPageNo=0,get_record($("#record_tab > .main"),20,"tab"),$("#record_tab").fadeIn(300)}}else if("商机"==t){if(0==$("#opportunity_tab").length){$(".tab").length>0&&$(".tab").remove();var e=$('<ul id="opportunity_tab" class="tab opportunity boxSizing"><div class="main boxSizing"></div></ul>');$("body").append(e),opportunityPageNo=0,get_opportunity($("#opportunity_tab > .main"),20,"tab"),$("#opportunity_tab").fadeIn(300)}}else if("详情"==t){if(0==$("#info_tab").length){$(".tab").length>0&&$(".tab").remove();var e=$('<ul id="info_tab" class="tab details boxSizing"><div class="main boxSizing"></div></ul>');$("body").append(e),get_info($("#info_tab > .main")),$("#info_tab").append($('<div class="staff boxSizing"> <div class="owner boxSizing"> <span class="label">负责人:</span> <span class="value"></span> </div> <div class="member boxSizing"> <span class="label">团队成员:</span> <span class="value"></span> </div> </div>')),$("#info_tab").fadeIn(300)}}else"全部"==t&&($(".tab").remove(),$(".content").fadeIn(300),get_info($("#infoList > .main")))}function get_record(t,e,a){t.children().remove(),$.ajax({url:apppath+"/wx/feed/list.action",data:{belongId:1,objectId:GetQueryString("accountId"),pagesize:e,pageNo:recordPageNo+1},dataType:"json",success:function(e){if(1==e.success)if(0==e.entity.feeds.length)t.css("border",0),t.append(reminderHtml),console.log("该对象暂无跟进记录");else{if(e.entity.hasMore){if(0==$("#recordList .more").length){var o=$('<a class="more"></a>');$("#recordList > .top").append(o)}$("#recordList .more").on("click",function(){$("#nav > .record").addClass("active"),$("#nav > .record").siblings().removeClass("active"),tab($("#nav > .record").attr("href"))})}build_record_list(t,e),e.entity.hasMore&&"tab"==a?($("#loading").remove(),build_end(t,"加载更多","load_more"),recordPageNo+=1,scroll_load(t,get_record)):$("#loading").remove()}else e.entity&&e.entity.status&&"0000003"==e.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("暂时无法获取数据，请稍后再试")},error:function(){console.log("暂时无法获取数据，请检查您的网络")}})}function build_record_list(t,e){for(var a=e.entity.feeds,o=0;o<a.length;o++){var n,i,c=a[o].user.name,r=a[o].from.name,s=a[o].from.belongId,d=4;a[o].relateBelongId&&(d=Number(a[o].relateBelongId));var l=a[o].relateObjectId,p=a[o].from.id;if(a[o].activityRecord.typeName)n=a[o].activityRecord.typeName;else{p=l,s=d,r=a[o].content;var m=a[o].stream.action;if(1==m)switch(d){case 1:n="创建了公司";break;case 2:n="创建了联系人";break;case 3:n="创建了销售机会"}else if(3==m)switch(d){case 1:n="删除了公司";break;case 2:n="删除了联系人";break;case 3:n="删除了销售机会"}else if(4==m)n="转移了公司";else if(5==m)switch(d){case 1:n="添加了公司";break;case 2:n="添加了联系人";break;case 3:n="添加了销售机会";break;case 4:n="增加了团队成员"}else if(6==m)switch(d){case 1:n="移除了公司";break;case 2:n="移除了联系人";break;case 3:n="移除了销售机会";break;case 4:n="移除了团队成员"}else 11==m?n="改变了商机状态":15==m&&(n="增加了团队成员")}var u=new Date(a[o].createdAt),f=u.getFullYear(),g=u.getMonth()+1;10>g&&(g="0"+g);var v=u.getDate();10>v&&(v="0"+v);var h=u.getHours();10>h&&(h="0"+h);var y=u.getMinutes();10>y&&(y="0"+y);var b=f+"-"+g+"-"+v,_=h+":"+y;if(0==o){var I=$('<div class="day"><em></em><p class="startDate">'+b+'</p><div class="ban"></div></div>');t.append(I)}else{var x=new Date(a[o].createdAt).getFullYear()+"-"+new Date(a[o].createdAt).getMonth()+"-"+new Date(a[o].createdAt).getDate(),w=new Date(a[o-1].createdAt).getFullYear()+"-"+new Date(a[o-1].createdAt).getMonth()+"-"+new Date(a[o-1].createdAt).getDate();if(x!=w){var I=$('<div class="day"><em></em><p class="startDate">'+b+'</p><div class="ban"></div></div>');t.append(I)}}var S=$('<li class="boxSizing"><div class="info"><span class="userName">'+c+'</span><span class="typeName">'+n+':</span><a class="objectName">'+r+'</a><span class="startTime">'+_+"</span></div></li>");if(S.find(".objectName").attr({belongId:s,objectId:p}),p!=GetQueryString("accountId")&&S.find(".objectName").on("click",function(){var t;if(1==$(this).attr("belongId"))t=apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+$(this).attr("objectId")+"&from=acc_info&raccountId="+GetQueryString("accountId");else if(2==$(this).attr("belongId"))t=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+$(this).attr("objectId")+"&from=acc_info&raccountId="+GetQueryString("accountId");else{if(3!=$(this).attr("belongId"))return!1;t=apppath+"/wx/opportunity/detail.action?"+ddcommparams+"&opportunityId="+$(this).attr("objectId")+"&from=acc_info&raccountId="+GetQueryString("accountId")}location.href=t}),"电话"==n?S.addClass("phone_bg"):"拜访签到"==n?S.addClass("sign_in_bg"):"快速记录"==n?S.addClass("record_bg"):"创建了公司"==n||"删除了公司"==n||"添加了公司"==n||"移除了公司"==n||"转移了公司"==n?S.addClass("account_bg"):"创建了联系人"==n||"删除了联系人"==n||"添加了联系人"==n||"移除了联系人"==n?S.addClass("contact_bg"):"创建了销售机会"==n||"删除了销售机会"==n||"添加了销售机会"==n||"移除了销售机会"==n||"改变了商机状态"==n?S.addClass("opportunity_bg"):"增加了团队成员"!=n&&"转移了团队成员"!=n&&"移除了团队成员"!=n||S.addClass("member_bg"),a[o].activityRecord.typeName&&a[o].content){i=a[o].content;var N=$('<span class="content_span">'+i+"</span>"),k=$('<div class="content"></div>'),G=$('<em class="triangle"></em>');if(k.append(N),k.append(G),i.length>32){var Q=i.substr(0,30)+"...",j=$('<span class="short_content_span">'+Q+"</span>");k.append(j),N.css("display","none");var T=0,A=$('<em class="more"></em>');A.on("click",function(){T++,$(this).parent().find(".short_content_span").slideToggle(),$(this).parent().find(".content_span").slideToggle(),$(this).css("transform","rotate("+(90+180*T)+"deg)")}),k.append(A)}S.append(k)}if(a[o].location.detail){var z=$('<div class="location">'+a[o].location.detail+"</div>");S.append(z)}var C=$('<div class="bottom_border"></div>');S.append(C),t.append(S)}removeBorder()}function removeBorder(){$("#record_tab li").each(function(){$(this).next().hasClass("day")&&$(this).find("div:last-child").css("borderBottom",0)})}function get_contacts(t,e,a){$.ajax({url:apppath+"/wx/contact/dolist.action",data:{accountId:GetQueryString("accountId"),pagesize:e,orderField:"createdAt",pageNo:contactPageNo},dataType:"json",success:function(e){if(1==e.success)if(0==e.entity.records.length)t.css("border",0),t.append(reminderHtml),console.log("该对象暂无联系人信息");else{if(e.entity.totalSize>5){if(0==$("#contactList .more").length){var o=$('<a class="more"></a>');$("#contactList > .top").append(o)}$("#contactList .more").on("click",function(){$("#nav > .contact").addClass("active"),$("#nav > .contact").siblings().removeClass("active"),tab($("#nav > .contact").attr("href"))})}var n=e.entity.totalSize;$("#contactList > .top > .title").text("联系人("+n+")"),$("#nav > .contact").text("联系人("+n+")"),build_contact_list(t,e),t.find("li").length<n&&"tab"==a?($("#loading").remove(),build_end(t,"加载更多","load_more"),contactPageNo++,scroll_load(t,get_contacts)):$("#loading").remove()}else e.entity&&e.entity.status&&"0000003"==e.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("暂时无法获取数据，请稍后再试")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_contact_list(t,e){for(var a=e.entity.records,o=0;o<a.length;o++){var n=a[o].contactName,i=a[o].post,c=a[o].mobile,r=a[o].id,s=$('<li class="boxSizing"><span class="name">'+n+'</span><span class="post">'+i+'</span><a href="tel:'+c+'" class="tel"></a></li>');s.attr("value",r),s.on("click",function(){location.href=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+$(this).attr("value")+"&from=acc_info&raccountId="+GetQueryString("accountId")}),s.find(".tel").on("click",function(t){var e=$(this).parent().attr("value");location.href=apppath+"/wx/activityrecord/create.action?"+ddcommparams+"&belongId=2&objectId="+e+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=acc_info&accountId="+GetQueryString("accountId"),t.stopPropagation()}),t.append(s)}}function get_opportunity(t,e,a){$.ajax({url:apppath+"/wx/opportunity/dolist.action",data:{accountId:GetQueryString("accountId"),pageNo:opportunityPageNo,pagesize:e,orderField:"updatedAt"},dataType:"json",success:function(e){if(1==e.success)if(0==e.entity.records.length)t.css("border",0),t.append(reminderHtml),console.log("该对象暂无销售机会信息");else{if(e.entity.totalSize>3){if(0==$("#opportunityList .more").length){var o=$('<a class="more"></a>');$("#opportunityList > .top").append(o)}$("#opportunityList .more").on("click",function(){$("#nav > .chance").addClass("active"),$("#nav > .chance").siblings().removeClass("active"),tab($("#nav > .chance").attr("href"))})}var n=e.entity.totalSize;$("#opportunityList > .top > .title").text("销售机会("+n+")"),$("#nav > .chance").text("销售机会("+n+")"),build_opportunity(t,e),t.find("li").length<n&&"tab"==a?($("#loading").remove(),build_end(t,"加载更多","load_more"),opportunityPageNo++,scroll_load(t,get_opportunity)):$("#loading").remove()}else 0==e.success&&(e.entity&&e.entity.status&&"0000003"==e.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("暂时无法获取数据，请稍后再试"))},error:function(t,e){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_opportunity(t,e){for(var a=0,o=e.entity.records.length;o>a;a++){var n=e.entity.records[a],i=n.saleStageText,c=n.opportunityName,r=n.money,s=n.accountName,d=n.id,l=n.saleStageOrder,p=n.saleStagePercentage,m=$('<li class="boxSizing"><em class="icon jieduan'+l+'"></em><div class="info"><div class="top"><span class="opportunityName">'+c+'</span><span class="Money">'+r+'元</span></div><div class="bot"><p class="accountName">'+s+'</p><p class="jieduan">阶段：'+i+'</p><span class="jieduan_p">'+p+"%</span></div></div></li>");m.attr("value",d),m.on("click",function(){location.href=apppath+"/wx/opportunity/detail.action?"+ddcommparams+"&opportunityId="+$(this).attr("value")+"&from=acc_info&raccountId="+GetQueryString("accountId")}),t.append(m)}}function get_info(t){$.ajax({url:apppath+"/wx/account/getDetail.action",data:{accountId:GetQueryString("accountId"),scene:"DETAIL"},dataType:"json",success:function(e){console.log(e),1==e.success?($(".load-shadow").hide(),dataPermission=e.entity.expandPro.dataPermission,build_info(t,e),ownerName=e.entity.expandPro.ownerIdText,$(".owner .value").text(ownerName),ownerId=e.entity.data.ownerId,dataPermission.transfer?change_owner():$(".owner").css("background","none"),dataPermission.update?change_member():$(".member").css("background","none"),get_member(),$(".common .title").text(e.entity.data.accountName),accountName=e.entity.data.accountName,null!=e.entity.data.phone?$("footer > .tel").attr("href","tel:"+e.entity.data.phone):$("footer > .tel").attr("href","")):"300032"==e.errorCode?"opp_info"==GetQueryString("from")?location.href=apppath+"/wx/opportunity/detail.action?"+ddcommparams+"&opportunityId="+GetQueryString("ropportunityId")+"&err=acc_deleted":"con_info"==GetQueryString("from")?location.href=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+GetQueryString("rcontactId")+"&err=acc_deleted":"acc_info"==GetQueryString("from")?location.href=apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("raccountId")+"&err=acc_deleted":"index"==GetQueryString("from")&&(GetQueryString("page")?location.href=apppath+"/wx/statics/index.action?"+ddcommparams+"&page="+GetQueryString("page")+"&err=acc_deleted":location.href=apppath+"/wx/statics/index.action?"+ddcommparams):e.entity&&e.entity.status&&"0000003"==e.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:e.entity&&e.entity.status&&"0000004"==e.entity.status?"opp_info"==GetQueryString("from")?location.href=apppath+"/wx/opportunity/detail.action?"+ddcommparams+"&opportunityId="+GetQueryString("ropportunityId")+"&err=acc_noright":"con_info"==GetQueryString("from")?location.href=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+GetQueryString("rcontactId")+"&err=acc_noright":"acc_info"==GetQueryString("from")?location.href=apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("raccountId")+"&err=acc_noright":"index"==GetQueryString("from")&&(GetQueryString("page")?location.href=apppath+"/wx/statics/index.action?"+ddcommparams+"&page="+GetQueryString("page")+"&err=acc_noright":location.href=apppath+"/wx/statics/index.action?"+ddcommparams+"&err=acc_noright"):myAlert("暂时无法获取数据，请稍后再试")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_info(t,e){t.children().remove();for(var a,o='<span style="color:#8fa1b2">暂无数据</span>',n=e.entity.structure.components,i=0,c=n.length;c>i;i++){a=set_infoSup(n[i].propertyName,e);var r,s;new Date;if("createdBy"==n[i].propertyName||"updatedBy"==n[i].propertyName)info_atom_build(t,n[i].label,xsyUser.name,n[i].propertyName,n[i].type);else if("object"==typeof a)r=a.text,s=a.value,""==s?info_atom_build(t,n[i].label,o,n[i].propertyName,n[i].type):info_atom_build(t,n[i].label,r,n[i].propertyName,n[i].type);else if(r=s=a,""==s)info_atom_build(t,n[i].label,o,n[i].propertyName,n[i].type);else if("region"==n[i].propertyName){var d=e.entity.data.state,l=e.entity.data.city,p=e.entity.data.region,m=d+" "+l+" "+p;info_atom_build(t,n[i].label,m,n[i].propertyName,n[i].type)}else info_atom_build(t,n[i].label,a,n[i].propertyName,n[i].type)}if(""!=a){var u=a;if(u.length>32){var f=u.substr(0,30)+"...",g=$('<span class="short_content_span">'+f+"</span>");content.append(g),content_span.css("display","none");var v=0,h=$('<em class="more"></em>');h.on("click",function(){v++,$(this).parent().find(".short_content_span").slideToggle(),$(this).parent().find(".content_span").slideToggle(),$(this).css("transform","rotate("+(90+180*v)+"deg)")}),content.append(h)}$(".staff .commentAtom").remove()}}function info_atom_build(t,e,a,o,n){var i='<span style="color:#8fa1b2">暂无数据</span>';if(""!=a){if("phone"==o){if(a==i)var c=$('<li class="atom boxSizing" id='+o+'><span class="label">'+e+'：</span><span class="value blue"><a href="tel:"> '+a+"</a></span></li>");else var c=$('<li class="atom boxSizing" id='+o+'><span class="label">'+e+'：</span><span class="value blue"><a href="tel:'+a+'"> '+a+"</a></span></li>");c.on("click",function(){location.href=apppath+"/wx/activityrecord/create.action?"+ddcommparams+"&belongId=1&objectId="+GetQueryString("accountId")+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=acc_info&accountId="+GetQueryString("accountId")})}if("ITEM_TYPE_LINE"==n)var c=$('<li class="atom boxSizing line-atom" id='+o+'><span class="line-title">'+e+"</span></a></li>");else{if("state"==o)return;if("city"==o)return;if("region"==o)var r="省市区",c=$('<li class="atom boxSizing" id='+o+'><span class="label">'+r+':</span><span class="value">'+a+"</span></li>");else var c=$('<li class="atom boxSizing" id='+o+'><span class="label">'+e+':</span><span class="value">'+a+"</span></li>")}t.append(c)}}function get_member(){$.ajax({type:"post",url:apppath+"/wx/group/relateowner.action",data:{businessId:GetQueryString("accountId"),belongs:1},dataType:"json",success:function(t){if($(".load-shadow").hide(),0==t.success)myAlert("暂时无法获取数据，请稍后再试");else{memberNameArr=[],memberIdArr=[];var e=t.entity.users;$.each(e,function(t,e){memberNameArr.push(e.name),memberIdArr.push(e.id)}),$(".member > .value").text(memberNameArr.join(" , "))}},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function change_owner(){$(".staff .owner").on("click",function(){get_owner_list()})}function get_owner_list(){$.ajax({type:"get",url:apppath+"/wx/xsyuser/pager.action",async:!0,dataType:"json",success:function(t){if($(".load-shadow").hide(),0==t.success)myAlert("暂时无法获取数据，请稍后再试");else if(1==t.entity.records.length){var e=$('<div class="no_contact">您的公司下暂时没有其他员工</div>');$("body").append(e),setTimeout(function(){$(".no_contact").remove()},2e3)}else{checkTable("转移给他人");var a=$('<ul id="container" class="container ownerContainer"></ul>');$(".ct").append(a),build_owner_list(a,t)}}})}function build_owner_list(t,e){for(var a=0,o=e.entity.records.length;o>a;a++){if(e.entity.records[a].name==$("#infoList .owner > .value").text())var n=$('<div class="item"><em class="radio active"><i></i></em><span>'+e.entity.records[a].name+"</span></div>");else var n=$('<div class="item"><em class="radio"><i></i></em><span>'+e.entity.records[a].name+"</span></div>");t.append(n)}radio_click(e)}function radio_click(t){$(".ct .item").each(function(e){$(this).on("click",function(){function e(){$.ajax({url:apppath+"/wx/account/changeto.action",data:{accountId:GetQueryString("accountId"),ownerid:o},dataType:"json",beforeSend:function(){loader()},success:function(t){$(".loaderArea").remove(),setTimeout(function(){ctRemove()},2e3),1==t.success?($(".owner > .value").text(a),get_record($("#recordList > .main"),5),myDialog("负责人更改成功"),ownerId=o):myAlert("负责人更改失败")},error:function(){$(".loaderArea").remove(),myAlert("暂时无法获取数据，请检查您的网络")}})}$(this).find("em").hasClass("active")||($(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active"));var a=t.entity.records[$(this).index()].name,o=t.entity.records[$(this).index()].id;doChangeOwner(a,e)})})}function change_member(){$(".member").on("click",function(){get_member_list()})}function get_member_list(){$.ajax({type:"get",url:apppath+"/wx/xsyuser/pager.action",async:!0,dataType:"json",success:function(t){if($(".load-shadow").hide(),0==t.success)myAlert("暂时无法获取数据，请稍后再试");else if(1==t.entity.records.length){var e=$('<div class="no_contact">您的公司下暂时没有其他员工</div>');$("body").append(e),setTimeout(function(){$(".no_contact").remove()},2e3)}else{checkTable("修改团队成员");var a=$('<ul id="container" class="container"></ul>');$(".ct").append(a),build_member_list(a,t)}}})}function build_member_list(t,e){for(var a=$("#infoList .member > .value").text().split(","),o=0,n=e.entity.records.length;n>o;o++){var i=e.entity.records[o].name;if(i!=ownerName){var c=$('<li class="item"><em class="checkbox"></em><span>'+i+"</span></li>");c.attr("value",e.entity.records[o].id),t.append(c)}}for(var r=e.entity.records,s=0,n=a.length;n>s;s++)for(var o=0,n=r.length;n>o;o++)$.trim(a[s])==$(".ct .item").eq(o).find("span").text()&&$(".ct .item").eq(o).find("em").addClass("active");checkbox_click(e),create_confirm(e)}function checkbox_click(t){$(".item").each(function(t){$(this).on("click",function(){memberChange=!0,$(this).find("em").hasClass("active")?$(this).find("em").removeClass("active"):$(this).find("em").addClass("active")})})}function create_confirm(t){var e=$('<button id="confirm" class="confirm">确定</button>');$(".ct").append(e),e.on("touchstart",function(){$(this).addClass("touching")}),e.on("touchend",function(){$(this).removeClass("touching")}),e.on("click",function(){var t=[];$(".item").each(function(){$(this).find("em").hasClass("active")&&t.push($(this).attr("value"))}),console.log("团队成员提交"+t.join(",")),$.ajax({type:"post",url:apppath+"/wx/group/setrelateowner.action",data:{businessId:GetQueryString("accountId"),belongs:1,setOwnerIds:t.join(",")},dataType:"json",async:!0,success:function(t){setTimeout(function(){$(".ct").remove(),$("body").css({height:"",overflow:""}),set_title("公司信息")},2e3),1==t.success?(console.log("团队成员提交成功："+t),myDialog("更改成功"),get_member(),get_record($("#recordList > .main"),5)):myAlert("更改失败")},error:function(t){myAlert("暂时无法获取数据，请检查您的网络")}})})}function footer_phone(){$("footer .tel").on("click",function(){$(window).scrollTop(0),$.ajax({url:apppath+"/wx/contact/dolist.action",data:{accountId:GetQueryString("accountId"),pageNo:0,pagesize:30},dataType:"json",success:function(t){var e=t.entity.records,a=t.entity.totalSize;if(0==a){if(0==$(".no_contact").length){var o=$('<div class="no_contact">暂无联系人可用，请添加联系人</div>');$("body").append(o),setTimeout(function(){$(".no_contact").remove()},2e3)}}else{var n=$('<div class="tel_bg"></div>');n.on("click",function(){$(".tel_bg").remove(),$("#mobile_list").remove()}),$("body").append(n),$(".tel_bg").css("top",$(document).scrollTop()),$(".tel_bg").fadeIn(200);for(var i=$('<div id="mobile_list"></div>'),c=0;a>c;c++){console.log(e[c]);var r=e[c].mobile,s=e[c].contactName,d=e[c].id,l=e[c].post,p=$('<a href="tel:'+r+'" class="mobile_atom"><div class="left boxSizing"><span class="name">'+s+'</span><span class="post">'+l+'</span></div><span class="mobile boxSizing">'+r+"</span></a>");p.attr("id",d),p.on("click",function(){location.href=apppath+"/wx/activityrecord/create.action?"+ddcommparams+"&belongId=2&objectId="+$(this).attr("id")+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=acc_info&accountId="+GetQueryString("accountId")}),i.append(p)}var m=$('<li id="rtn_btn">取消</li>');m.on("click",function(){$("body").css({overflow:"",height:""}),$(".tel_bg").remove(),$("#mobile_list").animate({bottom:-$("#mobile_list").height()},300),setTimeout(function(){$("#mobile_list").remove()},300)}),i.append(m),$("body").append(i),$("body").css({overflow:"hidden",height:"100%"}),$("#mobile_list").on("touchmove",function(t){t.stopPropagation()}),$("#mobile_list").css({bottom:-$("#mobile_list").height()}),$("#mobile_list").animate({bottom:"0"},300)}}})})}function footer_signin(){$("footer > .signin").on("click",function(){location.href=apppath+"/wx/activityrecord/qiandao.action?"+ddcommparams+"&belongId=1&objectId="+GetQueryString("accountId")+"&activityTypeId="+activeRecordTypeOje.SIGN_IN+"&from=acc_info&accountId="+GetQueryString("accountId")})}function footer_create_record(){$("footer > .record").on("click",function(){location.href=apppath+"/wx/activityrecord/create.action?"+ddcommparams+"&belongId=1&objectId="+GetQueryString("accountId")+"&activityTypeId="+activeRecordTypeOje.RECORD+"&from=acc_info&accountId="+GetQueryString("accountId")})}function build_end(t,e,a){var o=$('<div id="'+a+'" class="end_info">'+e+"</div>");t.append(o)}function scroll_load(t,e){var a=document.body.clientHeight;$(window).on("scroll",function(){$("#load_more").length>0&&$("#load_more").offset().top-$(document).scrollTop()<=a-$("#load_more").height()-50&&($("#load_more").remove(),build_end(t,"加载中…","loading"),e(t,20),$(this).unbind("scroll"),top_nav())})}$(document).on("ready",function(){top_nav(),nav(),linkMore(),more(),get_record($("#recordList > .main"),5),get_opportunity($("#opportunityList > .main"),3),get_contacts($("#contactList > .main"),5),get_info($("#infoList > .main")),footer_phone(),footer_signin(),footer_create_record(),filter_touch(),$("body").on("click",function(){$("#area").length>0&&$("#area").remove()}),$("body").on("touchmove",function(){$("#area").length>0&&$("#area").remove()})});var reminderHtml='<div class="content-reminder"><div class="ico"><p>暂无数据</p></div></div>',accountName,nav_top=$("#topNav").offset().top,nav_top=$("#topNav").offset().top,nav_height=$("#topNav").height(),recordPageNo=0,contactPageNo=0,opportunityPageNo=0,ownerId,dataPermission,ownerName,memberNameArr=[],memberIdArr=[],memberName,memberChange=!1;